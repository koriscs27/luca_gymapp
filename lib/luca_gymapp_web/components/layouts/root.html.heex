<!DOCTYPE html>
<html lang="en">
  <% barion_pixel_id = Application.get_env(:luca_gymapp, :barion_pixel_id) %>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="LucaGymapp" suffix=" · Phoenix Framework">
      {assigns[:page_title]}
    </.live_title>
    <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>

    <script>
      (() => {
        const setTheme = (theme) => {
          if (theme === "system") {
            localStorage.removeItem("phx:theme");
            document.documentElement.removeAttribute("data-theme");
          } else {
            localStorage.setItem("phx:theme", theme);
            document.documentElement.setAttribute("data-theme", theme);
          }
        };
        if (!document.documentElement.hasAttribute("data-theme")) {
          setTheme(localStorage.getItem("phx:theme") || "system");
        }
        window.addEventListener("storage", (e) => e.key === "phx:theme" && setTheme(e.newValue || "system"));
        
        window.addEventListener("phx:set-theme", (e) => setTheme(e.target.dataset.phxTheme));
      })();
    </script>

    <%= if barion_pixel_id do %>
      <script>
        window["bp"] = window["bp"] || function () {
          (window["bp"].q = window["bp"].q || []).push(arguments);
        };
        window["bp"].l = 1 * new Date();

        const scriptElement = document.createElement("script");
        const firstScript = document.getElementsByTagName("script")[0];
        scriptElement.async = true;
        scriptElement.src = "https://pixel.barion.com/bp.js";
        firstScript.parentNode.insertBefore(scriptElement, firstScript);
        window["barion_pixel_id"] = "<%= barion_pixel_id %>";

        bp("init", "addBarionPixelId", window["barion_pixel_id"]);
      </script>
    <% end %>
  </head>

  <body class="min-h-screen flex flex-col">
    <%= if barion_pixel_id do %>
      <noscript>
        <img
          height="1"
          width="1"
          style="display:none"
          alt="Barion Pixel"
          src={"https://pixel.barion.com/a.gif?ba_pixel_id=#{URI.encode_www_form(barion_pixel_id)}&ev=contentView&noscript=1"}
        />
      </noscript>
    <% end %>
    <main class="flex-1">
      {@inner_content}
    </main>
    <% support_email =
      Application.get_env(:luca_gymapp, :support_email) || "support@lucagymapp.local" %>
    <% coach_email =
      Application.get_env(:luca_gymapp, :coach_contact_email) || "pankotailucafitness@gmail.com" %>
    <% coach_phone = Application.get_env(:luca_gymapp, :coach_contact_phone) || "+36705030443" %>
    <footer class="border-t border-slate-200 bg-slate-50 px-4 py-5 text-slate-700 sm:px-6 lg:px-8">
      <div class="mx-auto flex w-full max-w-6xl flex-col gap-3 text-center sm:text-left">
        <div class="flex items-center justify-center gap-2 sm:justify-start">
          <.icon name="hero-information-circle" class="h-5 w-5 shrink-0 text-slate-500" />
          <p class="text-sm font-semibold text-slate-800">Kapcsolati információk</p>
        </div>

        <div class="grid gap-2 text-sm sm:grid-cols-3">
          <a
            href={"mailto:#{coach_email}"}
            class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-3 py-1 font-medium text-slate-700 underline decoration-slate-400 underline-offset-2 transition hover:bg-slate-100 sm:justify-start"
          >
            E-mail: {coach_email}
          </a>
          <a
            href={"tel:#{coach_phone}"}
            class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-3 py-1 font-medium text-slate-700 transition hover:bg-slate-100 sm:justify-start"
          >
            Telefon: {coach_phone}
          </a>
          <a
            href={"mailto:#{support_email}"}
            class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-3 py-1 font-medium text-slate-700 underline decoration-slate-400 underline-offset-2 transition hover:bg-slate-100 sm:justify-start"
          >
            Ügyfélszolgálat: {support_email}
          </a>
        </div>
      </div>
    </footer>
  </body>
</html>
